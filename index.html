<!DOCTYPE html>
<html>
<head>
  <style>
    /* Estilos para el men칰 */
    .menu {
      text-align: center;
    }

    .menu button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
    }

    /* Estilos para el tablero de juego */
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }

    td {
      width: 30px;
      height: 30px;
      border: 1px solid black;
      text-align: center;
      font-size: 20px;
      cursor: pointer;
    }

    /* Estilo para el bot칩n bloqueado */
    .blocked {
      background-color: yellow;
      position: relative;
    }

    /* Estilo para el emoji de bandera */
    .blocked::before {
      content: "游땽";
      font-size: 20px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <h1 id="welcomeText">Bienvenido al juego</h1>
  
  <div id="startMenu">
    <button id="startButton" onclick="iniciarJuego()">Iniciar</button>
  </div>
  
  <div id="gameMenu" style="display: none;">
    <div class="menu">
      <h1>Selecciona una dificultad</h1>
      <button onclick="crearTablero(9)">Principiante (9x9)</button>
      <button onclick="crearTablero(16)">Intermedio (16x16)</button>
      <button onclick="crearTablero(32)">Avanzado (32x32)</button>
    </div>
  </div>

  <table id="board" style="display: none;"></table>

  <script>
    var juegoIniciado = false; // Variable para controlar si el juego ha sido iniciado
    var board = document.getElementById('board'); // Referencia al elemento de la tabla
    var restartButton; // Variable para almacenar la referencia al bot칩n "Reiniciar"
  
    // Funci칩n para mostrar el men칰 de selecci칩n de dificultad
    function mostrarMenu() {
      document.getElementById('startMenu').style.display = 'none';
      document.getElementById('gameMenu').style.display = 'block';
    }

    // Funci칩n para iniciar el juego
    function iniciarJuego() {
      document.getElementById('welcomeText').style.display = 'none';
      mostrarMenu();
    }
    
    // Funci칩n para reiniciar el juego
    function reiniciarJuego() {
      // Aqu칤 puedes agregar la l칩gica para reiniciar tu juego
      juegoIniciado = false; // Establece el juego como no iniciado
      board.innerHTML = ''; // Elimina el contenido del tablero
      board.style.display = 'none'; // Oculta el tablero
      restartButton.style.display = 'none'; // Oculta el bot칩n "Reiniciar"
      mostrarMenu(); // Vuelve a mostrar el men칰 de selecci칩n de dificultad
    }

    // Funci칩n para mostrar el bot칩n "Reiniciar"
    function mostrarReinicio() {
      restartButton.style.display = 'inline-block';
    }

    // Funci칩n para ocultar el bot칩n "Reiniciar"
    function ocultarReinicio() {
      restartButton.style.display = 'none';
    }
    
    // Obtener los elementos de los botones por su ID
    var startButton = document.getElementById("startButton");
    var restartButton = document.getElementById("restartButton");
    
    // Agregar los controladores de eventos a los botones
    startButton.addEventListener("click", iniciarJuego);
    restartButton.addEventListener("click", reiniciarJuego);
  
    function crearTablero(tama침o) {
      // Oculta el men칰 y muestra el tablero
      document.getElementById('gameMenu').style.display = 'none';
      board.style.display = 'table';

      // Genera el tablero del tama침o especificado
      var tablero = [];
      for (var i = 0; i < tama침o; i++) {
        var row = document.createElement('tr');
        var fila = [];
        for (var j = 0; j < tama침o; j++) {
          var cell = document.createElement('td');
          cell.onclick = function() {
            if (!juegoActivo) return;
            var row = this.parentNode.rowIndex;
            var col = this.cellIndex;
            if (tablero[row][col].isMine) {
              // Has hecho clic en una mina, fin del juego
              alert('춰Entraste en cuarentena!');
              juegoActivo = false;
              // Mostrar emoji en casilla con mina
              this.innerHTML = '&#x1F9A0';
              this.style.background = 'red';
            } else {
              // No es una mina, muestra el n칰mero de minas adyacentes
              this.textContent = tablero[row][col].count;
              this.classList.add('revealed');
              if (tablero[row][col].count === 0) {
                // Si el n칰mero de minas adyacentes es cero, revela las casillas adyacentes
                revelarCasillasAdyacentes(row, col);
              }
            }
          };
          cell.oncontextmenu = function(e) {
            e.preventDefault(); // Evita que aparezca el men칰 contextual al hacer clic derecho
            if (!juegoActivo) return;

            // Cambia el estado bloqueado/desbloqueado del bot칩n de casilla
            if (this.classList.contains('blocked')) {
              desbloquearCasilla(this);
            } else {
              bloquearCasilla(this);
            }
          };
          fila.push({ element: cell, isMine: false, count: 0 });
          row.appendChild(cell);
        }
        tablero.push(fila);
        board.appendChild(row);
      }

      // Coloca minas aleatoriamente en el tablero
      var numMinas = Math.floor(tama침o * tama침o * 0.15); // Aproximadamente el 15% del total
      for (var k = 0; k < numMinas; k++) {
        var randomRow = Math.floor(Math.random() * tama침o);
        var randomCol = Math.floor(Math.random() * tama침o);
        if (!tablero[randomRow][randomCol].isMine) {
          tablero[randomRow][randomCol].isMine = true;
        } else {
          k--;
        }
      }

      // Calcula los n칰meros de minas adyacentes
      for (var m = 0; m < tama침o; m++) {
        for (var n = 0; n < tama침o; n++) {
          if (!tablero[m][n].isMine) {
            var count = 0;
            for (var p = Math.max(0, m - 1); p <= Math.min(m + 1, tama침o - 1); p++) {
              for (var q = Math.max(0, n - 1); q <= Math.min(n + 1, tama침o - 1); q++) {
                if (tablero[p][q].isMine) {
                  count++;
                }
              }
            }
            tablero[m][n].count = count;
          }
        }
      }

      var juegoActivo = true;

      function revelarCasillasAdyacentes(row, col) {
        for (var p = Math.max(0, row - 1); p <= Math.min(row + 1, tama침o - 1); p++) {
          for (var q = Math.max(0, col - 1); q <= Math.min(col + 1, tama침o - 1); q++) {
            var cell = tablero[p][q].element;
            if (!cell.classList.contains('revealed')) {
              cell.textContent = tablero[p][q].count;
              cell.classList.add('revealed');
              if (tablero[p][q].count === 0) {
                // Si el n칰mero de minas adyacentes es cero, revela las casillas adyacentes recursivamente
                revelarCasillasAdyacentes(p, q);
              }
            }
          }
        }
      }

      function bloquearCasilla(cell) {
        cell.classList.add('blocked');
        cell.originalOnClick = cell.onclick; // Almacena el evento onclick original
        cell.onclick = null; // Deshabilita el evento onclick
      }

      function desbloquearCasilla(cell) {
        cell.classList.remove('blocked');
        cell.onclick = cell.originalOnClick; // Restaura el evento onclick original
      }

      restartButton = document.createElement('button');
      restartButton.textContent = 'Reiniciar';
      restartButton.addEventListener('click', reiniciarJuego);
      board.parentNode.insertBefore(restartButton, board.nextSibling);
      mostrarReinicio(); // Muestra el bot칩n "Reiniciar"
    }
  </script>
</body>
</html>
