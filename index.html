<!DOCTYPE html>
<html>
<head>
  <style>
    /* Estilos para el men칰 */
    .menu {
      text-align: center;
    }

    .menu button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
    }

    /* Estilos para el tablero de juego */
    table {
      margin: 0 auto;
      border-collapse: collapse;
    }

    td {
      width: 30px;
      height: 30px;
      border: 1px solid black;
      text-align: center;
      font-size: 20px;
      cursor: pointer;
    }

    /* Estilo para el bot칩n bloqueado */
    .blocked {
      background-color: yellow;
      position: relative;
    }

    /* Estilo para el emoji de bandera */
    .blocked::before {
      content: "游땽";
      font-size: 20px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <div class="menu">
    <h1>Selecciona una dificultad</h1>
    <button onclick="crearTablero(9)">Principiante (9x9)</button>
    <button onclick="crearTablero(16)">Intermedio (16x16)</button>
    <button onclick="crearTablero(32)">Avanzado (32x32)</button>
  </div>

  <table id="board" style="display: none;"></table>

  <script>
    function crearTablero(tama침o) {
      // Oculta el men칰 y muestra el tablero
      document.querySelector('.menu').style.display = 'none';
      document.getElementById('board').style.display = 'table';

      // Obt칠n una referencia al elemento de la tabla
      var board = document.getElementById('board');

      // Genera el tablero del tama침o especificado
      var tablero = [];
      for (var i = 0; i < tama침o; i++) {
        var row = document.createElement('tr');
        var fila = [];
        for (var j = 0; j < tama침o; j++) {
          var cell = document.createElement('td');
          cell.onclick = function() {
            if (!juegoActivo) return;
            var row = this.parentNode.rowIndex;
            var col = this.cellIndex;
            if (tablero[row][col].isMine) {
              // Has hecho clic en una mina, fin del juego
              alert('Has perdido');
              juegoActivo = false;
            } else {
              // No es una mina, muestra el n칰mero de minas adyacentes
              this.textContent = tablero[row][col].count;
              this.classList.add('revealed');
              if (tablero[row][col].count === 0) {
                // Si el n칰mero de minas adyacentes es cero, revela las casillas adyacentes
                revelarCasillasAdyacentes(row, col);
              }
            }
          };
          cell.oncontextmenu = function(e) {
            e.preventDefault(); // Evita que aparezca el men칰 contextual al hacer clic derecho
            if (!juegoActivo) return;

            // Cambia el estado bloqueado/desbloqueado del bot칩n de casilla
            if (this.classList.contains('blocked')) {
              desbloquearCasilla(this);
            } else {
              bloquearCasilla(this);
            }
          };
          fila.push({ element: cell, isMine: false, count: 0 });
          row.appendChild(cell);
        }
        tablero.push(fila);
        board.appendChild(row);
      }

      // Coloca minas aleatoriamente en el tablero
      var numMinas = Math.floor(tama침o * tama침o * 0.15); // Aproximadamente el 15% del total
      for (var k = 0; k < numMinas; k++) {
        var randomRow = Math.floor(Math.random() * tama침o);
        var randomCol = Math.floor(Math.random() * tama침o);
        if (!tablero[randomRow][randomCol].isMine) {
          tablero[randomRow][randomCol].isMine = true;
        } else {
          k--;
        }
      }

      // Calcula los n칰meros de minas adyacentes
      for (var m = 0; m < tama침o; m++) {
        for (var n = 0; n < tama침o; n++) {
          if (!tablero[m][n].isMine) {
            var count = 0;
            for (var p = Math.max(0, m - 1); p <= Math.min(m + 1, tama침o - 1); p++) {
              for (var q = Math.max(0, n - 1); q <= Math.min(n + 1, tama침o - 1); q++) {
                if (tablero[p][q].isMine) {
                  count++;
                }
              }
            }
            tablero[m][n].count = count;
          }
        }
      }

      var juegoActivo = true;

      function revelarCasillasAdyacentes(row, col) {
        for (var p = Math.max(0, row - 1); p <= Math.min(row + 1, tama침o - 1); p++) {
          for (var q = Math.max(0, col - 1); q <= Math.min(col + 1, tama침o - 1); q++) {
            var cell = tablero[p][q].element;
            if (!cell.classList.contains('revealed')) {
              cell.textContent = tablero[p][q].count;
              cell.classList.add('revealed');
              if (tablero[p][q].count === 0) {
                // Si el n칰mero de minas adyacentes es cero, revela las casillas adyacentes recursivamente
                revelarCasillasAdyacentes(p, q);
              }
            }
          }
        }
      }

      function bloquearCasilla(cell) {
        cell.classList.add('blocked');
        cell.originalOnClick = cell.onclick; // Almacena el evento onclick original
        cell.onclick = null; // Deshabilita el evento onclick
      }

      function desbloquearCasilla(cell) {
        cell.classList.remove('blocked');
        cell.onclick = cell.originalOnClick; // Restaura el evento onclick original
      }
    }
  </script>
</body>
</html>
